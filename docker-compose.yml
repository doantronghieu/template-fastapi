services:
  # FastAPI App (optional - for containerized deployment)
  # For development, use: make dev (runs locally with Supabase and Redis Cloud)
  app:
    build:
      context: .
      dockerfile: docker/Dockerfile
    container_name: fastapi-app
    env_file: .env
    ports:
      - "${PORT:-8000}:${PORT:-8000}"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${PORT:-8000}/api/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s

  celery-worker:
    build:
      context: .
      dockerfile: docker/Dockerfile.celery
    container_name: celery-worker
    command: uv run celery -A app.core.celery:celery_app worker --loglevel=info --concurrency=1 --pool=solo
    env_file: .env

  flower:
    build:
      context: .
      dockerfile: docker/Dockerfile.celery
    container_name: flower
    command: uv run celery -A app.core.celery:celery_app flower --port=${FLOWER_PORT:-5555}
    env_file: .env
    ports:
      - "${FLOWER_PORT:-5555}:${FLOWER_PORT:-5555}"

# No volumes needed - using Supabase for database and Redis Cloud for caching
